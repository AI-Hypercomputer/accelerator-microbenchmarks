#!/usr/bin/env bash

xpk workload create --cluster "${CLUSTER}" --zone "${ZONE}" --device-type "tpu7x-128" \
  --command 'git clone https://github.com/AI-Hypercomputer/accelerator-microbenchmarks.git && cd accelerator-microbenchmarks && git checkout tpu7x-demo-0211 && pip install -r requirements.txt && export GCS_BUCKET_DIR=${GCS_PATH} && python Ironwood/src/run_benchmark.py --config="Ironwood/configs/collectives/all_gather_tpu7x_4x4x4.yaml" --gcs-bucket-csv-dir=${GCS_BUCKET_DIR} && python Ironwood/src/run_benchmark.py --config="Ironwood/configs/collectives/all_reduce_tpu7x_4x4x4.yaml" --gcs-bucket-csv-dir=${GCS_BUCKET_DIR} && python Ironwood/src/run_benchmark.py --config="Ironwood/configs/collectives/all_to_all_tpu7x_4x4x4.yaml" --gcs-bucket-csv-dir=${GCS_BUCKET_DIR}' \
  --num-slices "1" --docker-image=docker.io/library/python:3.12-bookworm --workload "tpu7x-4x4x4-collectives" --project "${PROJECT}"